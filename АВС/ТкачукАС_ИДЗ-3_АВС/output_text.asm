# output_text.asm
.include "macrolib.asm"

.text
.globl output_text
output_text:
    # Сохранение буфера и размера в регистрах
    mv t0, a1                  # t0 = адрес буфера
    mv t1, a2                  # t1 = размер данных

    # Открываем входной файл для записи
    open WRITE_ONLY
    mv t2, a0                  # t2 = дескриптор файла

    # Проверка на ошибку открытия файла
    li t3, -1
    beq t2, t3, write_error    # Если дескриптор == -1, перейти к обработке ошибки

    # Запись данных в файл
    mv a0, t2                  # Дескриптор файла
    mv a1, t0                  # Адрес буфера
    mv a2, t1                  # Размер данных
    li a7, 64                  # Номер системного вызова SYS_WRITE (64)
    ecall
    mv t4, a0                  # t4 = количество записанных байт

    # Проверка на ошибку записи
    blt t4, x0, write_error    # Если результат < 0, перейти к обработке ошибки

    # Закрытие файла
    close t2
    # Проверка на ошибку закрытия файла
    blt a0, x0, write_error    # Если результат < 0, перейти к обработке ошибки

    # Успешное завершение: возврат 0
    li a0, 0
    ret                        # Возврат из подпрограммы

write_error:
    li a0, -1                  # a0 = -1
    li a1, 0                   # a1 = 0
    ret                        # Возврат из подпрограммы